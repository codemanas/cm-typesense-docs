<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="codemanas">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Adding Custom Post Types - Search with Typesense</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Search with Typesense</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Installation</a>
                            </li>
                            <li >
                                <a href="../getting-started/">Getting Started</a>
                            </li>
                            <li >
                                <a href="../shortcode/">Shortcode</a>
                            </li>
                            <li >
                                <a href="../debug/">Debugging</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../template-overriding/">Overriding Template</a>
</li>
                                    
<li >
    <a href="../customizing-instant-search-widgets/">Customizing Widgets</a>
</li>
                                    
<li class="active">
    <a href="./">Adding Custom Post Types</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Addons <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../tsfwc/">Typsesense Search for WooCommerce</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../customizing-instant-search-widgets/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../tsfwc/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/codemanas/cm-typesense-docs/edit/master/docs/advanced-custom-post-types.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#adding-custom-post-type">Adding Custom Post Type</a></li>
            <li><a href="#introduction">Introduction</a></li>
            <li><a href="#adding-custom-post-type_1">Adding Custom Post Type</a></li>
            <li><a href="#adding-schema">Adding Schema</a></li>
            <li><a href="#formatting-data">Formatting Data</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="adding-custom-post-type">Adding Custom Post Type</h1>
<h2 id="introduction">Introduction</h2>
<p>By default, the plugin supports posts and pages for indexing. Adding additional / custom post types can be achieve via filter hooks.
There are three things you should be aware of.</p>
<ol>
<li><a href="#adding-custom-post-type_1">Adding the custom post type to available post types for indexing</a></li>
<li><a href="#adding-schema">Adding schema for your custom post type</a></li>
<li><a href="#formatting-data">Formatting data before documents are added</a></li>
</ol>
<p>For this guide - we have assumed that the custom post type is book, please note that the <code>slug</code> of custom post type is quite important.</p>
<pre><code>/**
 * Register a custom post type called &quot;book&quot;.
 *
 * @see get_post_type_labels() for label keys.
 */
function wp_docs_codex_book_init() {
    $labels = array(
        'name'                  =&gt; _x( 'Books', 'Post type general name', 'textdomain' ),
        'singular_name'         =&gt; _x( 'Book', 'Post type singular name', 'textdomain' ),
        'menu_name'             =&gt; _x( 'Books', 'Admin Menu text', 'textdomain' ),
        'name_admin_bar'        =&gt; _x( 'Book', 'Add New on Toolbar', 'textdomain' ),
        'add_new'               =&gt; __( 'Add New', 'textdomain' ),
        'add_new_item'          =&gt; __( 'Add New Book', 'textdomain' ),
        'new_item'              =&gt; __( 'New Book', 'textdomain' ),
        'edit_item'             =&gt; __( 'Edit Book', 'textdomain' ),
        'view_item'             =&gt; __( 'View Book', 'textdomain' ),
        'all_items'             =&gt; __( 'All Books', 'textdomain' ),
        'search_items'          =&gt; __( 'Search Books', 'textdomain' ),
        'parent_item_colon'     =&gt; __( 'Parent Books:', 'textdomain' ),
        'not_found'             =&gt; __( 'No books found.', 'textdomain' ),
        'not_found_in_trash'    =&gt; __( 'No books found in Trash.', 'textdomain' ),
        'featured_image'        =&gt; _x( 'Book Cover Image', 'Overrides the “Featured Image” phrase for this post type. Added in 4.3', 'textdomain' ),
        'set_featured_image'    =&gt; _x( 'Set cover image', 'Overrides the “Set featured image” phrase for this post type. Added in 4.3', 'textdomain' ),
        'remove_featured_image' =&gt; _x( 'Remove cover image', 'Overrides the “Remove featured image” phrase for this post type. Added in 4.3', 'textdomain' ),
        'use_featured_image'    =&gt; _x( 'Use as cover image', 'Overrides the “Use as featured image” phrase for this post type. Added in 4.3', 'textdomain' ),
        'archives'              =&gt; _x( 'Book archives', 'The post type archive label used in nav menus. Default “Post Archives”. Added in 4.4', 'textdomain' ),
        'insert_into_item'      =&gt; _x( 'Insert into book', 'Overrides the “Insert into post”/”Insert into page” phrase (used when inserting media into a post). Added in 4.4', 'textdomain' ),
        'uploaded_to_this_item' =&gt; _x( 'Uploaded to this book', 'Overrides the “Uploaded to this post”/”Uploaded to this page” phrase (used when viewing media attached to a post). Added in 4.4', 'textdomain' ),
        'filter_items_list'     =&gt; _x( 'Filter books list', 'Screen reader text for the filter links heading on the post type listing screen. Default “Filter posts list”/”Filter pages list”. Added in 4.4', 'textdomain' ),
        'items_list_navigation' =&gt; _x( 'Books list navigation', 'Screen reader text for the pagination heading on the post type listing screen. Default “Posts list navigation”/”Pages list navigation”. Added in 4.4', 'textdomain' ),
        'items_list'            =&gt; _x( 'Books list', 'Screen reader text for the items list heading on the post type listing screen. Default “Posts list”/”Pages list”. Added in 4.4', 'textdomain' ),
    );

    $args = array(
        'labels'             =&gt; $labels,
        'public'             =&gt; true,
        'publicly_queryable' =&gt; true,
        'show_ui'            =&gt; true,
        'show_in_menu'       =&gt; true,
        'query_var'          =&gt; true,
        'rewrite'            =&gt; array( 'slug' =&gt; 'book' ),
        'capability_type'    =&gt; 'post',
        'has_archive'        =&gt; true,
        'hierarchical'       =&gt; false,
        'menu_position'      =&gt; null,
        'supports'           =&gt; array( 'title', 'editor', 'author', 'thumbnail', 'excerpt', 'comments' ),
    );

    register_post_type( 'book', $args );
}

add_action( 'init', 'wp_docs_codex_book_init' );
/**
 * Create two taxonomies, genres and writers for the post type &quot;book&quot;.
 *
 * @see register_post_type() for registering custom post types.
 */
function wp_docs_create_book_taxonomies() {
    // Add new taxonomy, make it hierarchical (like categories)
    $labels = array(
        'name'              =&gt; _x( 'Genres', 'taxonomy general name', 'textdomain' ),
        'singular_name'     =&gt; _x( 'Genre', 'taxonomy singular name', 'textdomain' ),
        'search_items'      =&gt; __( 'Search Genres', 'textdomain' ),
        'all_items'         =&gt; __( 'All Genres', 'textdomain' ),
        'parent_item'       =&gt; __( 'Parent Genre', 'textdomain' ),
        'parent_item_colon' =&gt; __( 'Parent Genre:', 'textdomain' ),
        'edit_item'         =&gt; __( 'Edit Genre', 'textdomain' ),
        'update_item'       =&gt; __( 'Update Genre', 'textdomain' ),
        'add_new_item'      =&gt; __( 'Add New Genre', 'textdomain' ),
        'new_item_name'     =&gt; __( 'New Genre Name', 'textdomain' ),
        'menu_name'         =&gt; __( 'Genre', 'textdomain' ),
    );

    $args = array(
        'hierarchical'      =&gt; true,
        'labels'            =&gt; $labels,
        'show_ui'           =&gt; true,
        'show_admin_column' =&gt; true,
        'query_var'         =&gt; true,
        'rewrite'           =&gt; array( 'slug' =&gt; 'genre' ),
    );

    register_taxonomy( 'genre', array( 'book' ), $args );

    unset( $args );
    unset( $labels );

    // Add new taxonomy, NOT hierarchical (like tags)
    $labels = array(
        'name'                       =&gt; _x( 'Writers', 'taxonomy general name', 'textdomain' ),
        'singular_name'              =&gt; _x( 'Writer', 'taxonomy singular name', 'textdomain' ),
        'search_items'               =&gt; __( 'Search Writers', 'textdomain' ),
        'popular_items'              =&gt; __( 'Popular Writers', 'textdomain' ),
        'all_items'                  =&gt; __( 'All Writers', 'textdomain' ),
        'parent_item'                =&gt; null,
        'parent_item_colon'          =&gt; null,
        'edit_item'                  =&gt; __( 'Edit Writer', 'textdomain' ),
        'update_item'                =&gt; __( 'Update Writer', 'textdomain' ),
        'add_new_item'               =&gt; __( 'Add New Writer', 'textdomain' ),
        'new_item_name'              =&gt; __( 'New Writer Name', 'textdomain' ),
        'separate_items_with_commas' =&gt; __( 'Separate writers with commas', 'textdomain' ),
        'add_or_remove_items'        =&gt; __( 'Add or remove writers', 'textdomain' ),
        'choose_from_most_used'      =&gt; __( 'Choose from the most used writers', 'textdomain' ),
        'not_found'                  =&gt; __( 'No writers found.', 'textdomain' ),
        'menu_name'                  =&gt; __( 'Writers', 'textdomain' ),
    );

    $args = array(
        'hierarchical'          =&gt; false,
        'labels'                =&gt; $labels,
        'show_ui'               =&gt; true,
        'show_admin_column'     =&gt; true,
        'update_count_callback' =&gt; '_update_post_term_count',
        'query_var'             =&gt; true,
        'rewrite'               =&gt; array( 'slug' =&gt; 'writer' ),
    );

    register_taxonomy( 'writer', 'book', $args );
}

// hook into the init action and call create_book_taxonomies when it fires
add_action( 'init', 'wp_docs_create_book_taxonomies', 0 );
</code></pre>

<h2 id="adding-custom-post-type_1">Adding Custom Post Type</h2>
<p>The hook in question to use is : <code>cm_typesense_available_post_types</code></p>
<pre><code>/*** Adds the post type book under available post_types ***/
function cm_typesense_add_available_post_types( $available_post_types ) {
    $available_post_types['book'] = [ 'label' =&gt; 'Book', 'value' =&gt; 'book' ];

    return $available_post_types;
}
add_filter( 'cm_typesense_available_post_types',  'cm_typesense_add_available_post_types');
</code></pre>

<p>This will add your custom post type to the available post types dropdown in the backend. Which will allow you to enable the post type and index it.</p>
<p>IMPORTANT NOTE: Please note the index and value MUST be the post_slug</p>
<p>Result:
<img alt="Backend with Book Post type available" src="../img/additional-post-types.png" /></p>
<h2 id="adding-schema">Adding Schema</h2>
<p>Your schema for the custom post type would most likely need to be different for your custom post type. For example you may want to send custom taxonomies as facets for your post type. To do so you will need to modify / add your schema - BEFORE - any indexing is done</p>
<p>IMPORTANT NOTE: SCHEMA NEEDS TO BE DEFINED BEFORE COLLECTION IS CREATED.</p>
<pre><code>//only necessary if the default post schema is not necessary
function cm_typesense_add_book_schema( $schema, $name ) {
    if ( $name == 'book' ) {
        $schema = [
            'name'                  =&gt; 'book',
            'fields'                =&gt; [
                [ 'name' =&gt; 'post_content', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_title', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_type', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_author', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'comment_count', 'type' =&gt; 'int64' ],
                [ 'name' =&gt; 'is_sticky', 'type' =&gt; 'int32' ],
                [ 'name' =&gt; 'post_excerpt', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_date', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_id', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_modified', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'id', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'permalink', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'post_thumbnail', 'type' =&gt; 'string' ],
                [ 'name' =&gt; 'genre', 'type' =&gt; 'string[]', 'facet' =&gt; true ]
            ],
            'default_sorting_field' =&gt; 'comment_count'
        ];
    }


    return $schema;
}

add_filter( 'cm_typesense_schema', 'cm_typesense_add_book_schema', 10, 2 );
</code></pre>

<p>In the example above - you can see genre is being sent as a facet. "genre" is the custom taxonomy attached to the book post type.</p>
<h2 id="formatting-data">Formatting Data</h2>
<pre><code>//you can modify the code as needed 
//if your schema is simillar to the default post type then you should only change what fields you need to add
//example here we are only adding genre
function cm_typesense_format_book_data ( $formatted_data, $raw_data, $object_id, $schema_name ) {
    if ( $schema_name == 'book' ) {
        $terms  = get_the_terms( $object_id, 'genre' );
        $genres = [];
        foreach ( $terms as $term ) {
            $genres[] = $term-&gt;name;
        }
        $formatted_data['genre'] = $genres;
    }

    return $formatted_data;
}
add_filter( 'cm_typesense_data_before_entry', 'cm_typesense_format_book_data', 10, 4 );
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
